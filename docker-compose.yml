version: '3'
services:
  node:
    extends:
      file: ./.docker/compose/node.yml
      service: node
    volumes:
      - ${PWD}:/work
    ports:
      - '30050:3000'
    depends_on:
      - mongodb
    networks:
      - crane-network
  mongodb:
    extends:
      file: ./.docker/compose/mongodb.yml
      service: mongodb
    ports:
      - '27030:27017'
    volumes:
      - ./init-mongo.js:/docker-entrypoint-initdb.d/init-mongo.js:ro
      - ${PWD}/.docker/mongodb_data:/data/db
    networks:
      - crane-network

  redis:
    extends:
      file: ./.docker/compose/redis.yml
      service: redis
    ports:
      - '63079:6379'
    networks:
      - crane-network
    volumes:
      - ${PWD}/.docker/redis-data:/data
    command: redis-server --appendonly yes --dir /data

  redisinsight:
    extends:
      file: ./.docker/compose/redis.yml
      service: redisinsight
    depends_on:
      - redis
    volumes:
      - ${PWD}/.docker/redisinsight_data:/db
    ports:
      - '55040:5540'
    links:
      - redis
    networks:
      - crane-network

volumes:
  pgdata:
  redisinsight_data:

networks:
  crane-network:
    driver: bridge
